name: elt_pipeline

types:
  BronzeOutput:
    source: str
    count: int
  SilverOutput:
    source: str
    bronze_count: int
    silver_count: int
  GoldOutput:
    total_users: int
    total_posts: int
    total_comments: int
    avg_comments_per_user: float

tasks:
  bronze_posts:
    executor: python
    file: elt_pipeline.py
    function: bronze_loader
    timeout: 600
    retries: 1
    input_type:
      source: str
      date: date
      db_path: str
    output_type: types.BronzeOutput
    inputs:
      source:
        const: posts
      date:
        const: "2024-01-15"
      db_path:
        const: data/warehouse.db

  bronze_comments:
    executor: python
    file: elt_pipeline.py
    function: bronze_loader
    timeout: 600
    retries: 1
    input_type:
      source: str
      date: date
      db_path: str
    output_type: types.BronzeOutput
    inputs:
      source:
        const: comments
      date:
        const: "2024-01-15"
      db_path:
        const: data/warehouse.db

  bronze_users:
    executor: python
    file: elt_pipeline.py
    function: bronze_loader
    timeout: 600
    retries: 1
    input_type:
      source: str
      date: date
      db_path: str
    output_type: types.BronzeOutput
    inputs:
      source:
        const: users
      date:
        const: "2024-01-15"
      db_path:
        const: data/warehouse.db

  silver_posts:
    executor: python
    file: elt_pipeline.py
    function: silver_transformer
    depends_on: [bronze_posts]
    input_type:
      source: str
      db_path: str
      bronze: types.BronzeOutput
    output_type: types.SilverOutput
    inputs:
      source:
        const: posts
      db_path:
        const: data/warehouse.db
      bronze:
        ref: tasks.bronze_posts.output

  silver_comments:
    executor: python
    file: elt_pipeline.py
    function: silver_transformer
    depends_on: [bronze_comments]
    input_type:
      source: str
      db_path: str
      bronze: types.BronzeOutput
    output_type: types.SilverOutput
    inputs:
      source:
        const: comments
      db_path:
        const: data/warehouse.db
      bronze:
        ref: tasks.bronze_comments.output

  silver_users:
    executor: python
    file: elt_pipeline.py
    function: silver_transformer
    depends_on: [bronze_users]
    input_type:
      source: str
      db_path: str
      bronze: types.BronzeOutput
    output_type: types.SilverOutput
    inputs:
      source:
        const: users
      db_path:
        const: data/warehouse.db
      bronze:
        ref: tasks.bronze_users.output

  gold_analytics:
    executor: python
    file: elt_pipeline.py
    function: gold_analytics
    depends_on: [silver_posts, silver_comments, silver_users]
    input_type:
      db_path: str
      silver_posts: types.SilverOutput
      silver_comments: types.SilverOutput
      silver_users: types.SilverOutput
    output_type: types.GoldOutput
    inputs:
      db_path:
        const: data/warehouse.db
      silver_posts:
        ref: tasks.silver_posts.output
      silver_comments:
        ref: tasks.silver_comments.output
      silver_users:
        ref: tasks.silver_users.output
