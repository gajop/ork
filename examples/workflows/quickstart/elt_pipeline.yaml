name: elt_pipeline

tasks:
  bronze_posts:
    executor: python
    file: tasks/load_bronze.py
    input:
      source: posts
      date: "2024-01-15"
      db_path: data/warehouse.db
    timeout: 600
    retries: 1
    output_type:
      source: string
      count: integer

  bronze_comments:
    executor: python
    file: tasks/load_bronze.py
    input:
      source: comments
      date: "2024-01-15"
      db_path: data/warehouse.db
    timeout: 600
    retries: 1
    output_type:
      source: string
      count: integer

  bronze_users:
    executor: python
    file: tasks/load_bronze.py
    input:
      source: users
      date: "2024-01-15"
      db_path: data/warehouse.db
    timeout: 600
    retries: 1
    output_type:
      source: string
      count: integer

  silver_posts:
    executor: python
    file: tasks/transform_silver.py
    input:
      source: posts
      db_path: data/warehouse.db
    depends_on: [bronze_posts]
    input_type:
      upstream:
        bronze_posts:
          source: string
          count: integer
    output_type:
      source: string
      bronze_count: integer
      silver_count: integer

  silver_comments:
    executor: python
    file: tasks/transform_silver.py
    input:
      source: comments
      db_path: data/warehouse.db
    depends_on: [bronze_comments]
    input_type:
      upstream:
        bronze_comments:
          source: string
          count: integer
    output_type:
      source: string
      bronze_count: integer
      silver_count: integer

  silver_users:
    executor: python
    file: tasks/transform_silver.py
    input:
      source: users
      db_path: data/warehouse.db
    depends_on: [bronze_users]
    input_type:
      upstream:
        bronze_users:
          source: string
          count: integer
    output_type:
      source: string
      bronze_count: integer
      silver_count: integer

  gold_analytics:
    executor: python
    file: tasks/gold_analytics.py
    input:
      db_path: data/warehouse.db
    depends_on: [silver_posts, silver_comments, silver_users]
    input_type:
      upstream:
        silver_posts:
          source: string
          bronze_count: integer
          silver_count: integer
        silver_comments:
          source: string
          bronze_count: integer
          silver_count: integer
        silver_users:
          source: string
          bronze_count: integer
          silver_count: integer
    output_type:
      total_users: integer
      total_posts: integer
      total_comments: integer
      avg_comments_per_user: number
